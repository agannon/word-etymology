<script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
<script src="https://code.highcharts.com/highcharts.js"></script>
<script src="https://code.highcharts.com/modules/exporting.js"></script>
<script src="https://code.highcharts.com/modules/export-data.js"></script>
<div id="app">

  <div id="container"
       style="min-width: 310px; max-width: 600px; height: 400px; margin: 0 auto"></div>
</div>

<script>
urlString = "http://localhost:8080/api/words/"
urlString2 = "http://localhost:8080/api/words?blang=%german%"

let xhr = new XMLHttpRequest()
xhr.open("GET", urlString, true)
xhr.onload = function(e) {
  if (xhr.readyState === 4) {
    if (xhr.status === 200) {
      let j = JSON.parse(xhr.response)
      app.apiResponse = (j)
    }
  }
}
xhr.onerror = function(e) {
  console.error(xhr.statusText)
}
xhr.send(null)

var app = new Vue({
  el: "#app",
  data: {
    message: "Hello Vue!",
    apiResponse: [],
    series: "",
    keyword: "originLang"
  },
  methods: {
    getCount: function(lookup, json) {
      mapping = json.map(x => x[lookup])
      lookupSet = new Set(mapping)
      count = Array.from(lookupSet).map(x => [x, mapping.filter(y => y == x).length])
      return count
    },
    makeData: function(count) {
      dataFormat = []
      for (let i = 0; i < count.length; i++) {
        dict = { name: count[i][0], y: count[i][1] }
        dataFormat.push(dict)
      }
      return dataFormat
    },
    sortData: function(data) {
        return data.sort(function(a,b){return b.y-a.y})
    }
  },
  computed: {
    setData: function() {
      return this.sortData(this.makeData(this.getCount(this.keyword, this.apiResponse)))
    }
  },
  watch: {
    apiResponse: function(val) {
      c = Highcharts.charts[0]
      c.series[0].setData(this.setData)
    }
  }

})
Highcharts.chart("container", {
  chart: {
    plotBackgroundColor: null,
    plotBorderWidth: null,
    plotShadow: false,
    type: "pie"
  },
  title: {
    text: ""
  },
  plotOptions: {
    pie: {
      allowPointSelect: true,
      cursor: "pointer",
      dataLabels: {
        enabled: true,
        format: "<b>{point.name}</b>: {point.y}"
      }
    }
  },
  series: series = [{
    name: "",
    colorByPoint: true,
    data: app.setData

  }]
})
</script>

